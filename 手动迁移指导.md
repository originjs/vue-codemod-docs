[TOC]

# 手动迁移指导

手动迁移之前，请先使用 [vue-codemod](https://github.com/originjs/vue-codemod) 工具进行自动转换。工具使用方法请参考 [使用指导](./使用指导.md) 。

本迁移手册是基于已经转换的项目中的实际遇到的问题进行总结的，在更多真实项目的转换过程中，可能会遇到其他问题，欢迎提交 [issue](https://github.com/originjs/vue-codemod/issues) 或者 [PR](https://github.com/originjs/vue-codemod/pulls) 进行贡献。

## 限制

### Vue 版本

Vue 的版本需要不低于 **2.6.0**，如果使用了 2.6.0 之前的版本，可能部分语法无法自动转换。

### 第三方依赖

dependency 中有不支持 Vue 3 的库，暂时无法实现升级，需要选择其他依赖库替代，并重写部分逻辑。

目前已经支持 Vue 3 的 UI 框架库有：

- [quasar](https://github.com/quasarframework/quasar)
- [element-plus](https://github.com/element-plus/element-plus/)
- [ant-design-vue](https://github.com/vueComponent/ant-design-vue)

具体是否支持 Vue 3 ，可参考 [Vue2ToVue3](https://github.com/zdravkov/Vue2ToVue3)

## Vue 的手动迁移

### 全局 API

 [官方文档](https://v3.cn.vuejs.org/guide/migration/global-api.html)

- 使用**插件**的方式对`全局 API` 进行转换

  - 将非 main.js 中的全局 API 装载为插件形式

    Vue 2 中：

    ```js
    // directive/index.js
    import Vue from "vue";
    import myDirective from "@/directive/myDirective";

    Vue.directive('myDirective', myDirective) ;
    ```

    Vue 3 中：

    ```js
    // directive/index.js
    import myDirective from "@/directive/myDirective";

    export default{
        install: app => {
            app.directive('myDirective', myDirective) ;
        }
    }
    ```

  - 并在 main.js 中引用使用该插件

    ```js
    // main.js
    import MyDirective from '@/directive'

    Vue.createApp(App).use( myDirective)
    ```

- 使用 `window.app=app` 的方式对`全局配置`进行转换

  - main.js 中配置`全局 app` 实例

    ```js
    // main.js
    const app = Vue.createApp(App)
    window.app = app  // 配置全局 app 实例
    app.mount('#app')
    ```

  - 非 main.js 中的配置

    Vue 2 中:

    ```js
    // message/index.js
    Vue.prototype.$baseMessage = () => {
      Message({
        offset: 60,
        showClose: true
      })
    }
    ```

    Vue 3 中：

    ```js
    // message/index.js
    app.config.globalProperties.$baseMessage = () => {
      Message({
        offset: 60,
        showClose: true
      })
    }
    ```

    注意：使用 `window.app` 需要结合 Vue 框架中 js 代码的执行顺序，只有在 main.js 中 `window.app = app` 配置语句之后运行的代码才可以使用 `window.app`。已知在 main.js 之后运行的代码部分为：(1) 在 Vue 组件的 `export default {}` 中运行；(2) 在 main.js 使用 `app.use()` 的 js 文件。

### 插槽

### 过滤器

#### 局部 filter

详情见[官方迁移指导](https://v3.cn.vuejs.org/guide/migration/filters.htm)

#### 全局 filter

详情见[官方迁移指导](https://v3.cn.vuejs.org/guide/migration/filters.html#全局过滤器)

### 事件总线

详情见[官方迁移指导](https://v3.cn.vuejs.org/guide/migration/events-api.html)

### /deep/样式

### 分隔符

## Vue Router

### VueRouter.prototype

### path 中的通配符 *

## Vuex

## Vue-i18n

## Element-ui

目前 [Element UI](https://github.com/ElemeFE/element) 提供了适配 Vue 3 的组件库 [Element Plus](https://github.com/element-plus/element-plus)，涉及 `Element` 的部分需要手动升级。

### 升级依赖

```bash
npm install element-plus
npm remove element-ui
```

### 依赖替换

- import 中的 `source` 改变了，可以通过 IDE 进行全局替换：`import xx from 'element-ui'` -> `import xx from 'element-plus'`
- 部分组件名改变了，需要逐个手动识别：`import { Message } from 'element-ui'` -> `import { ElMessage } from 'element-plus'`

### 表格 el-table 作用域插槽

必须使用 `<template>` 配合 slot 的形式，例如：

```vue
<el-table>
  <span slot-scope='scope'>{{ scope.row.num }}</span>
</el-table>
```

需要切换成：

```vue
<el-table>
  <template #default='scope'>
    <span>{{ scope.row.num }}</span>
  </template>
</el-table>
```
